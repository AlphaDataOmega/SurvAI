## 🚀 M3\_PHASE\_09.md – Visual Snapshot Validation Harness

### FEATURE

Automate UI snapshot testing to catch visual regressions across the authenticated admin area and the public survey flow.  A headless browser will:

1. Log in as admin → capture dashboard & chat panel states
2. Start a survey session → click through first CTA question → capture survey screens
3. Compare snapshots to stored baselines and fail CI if deltas exceed threshold.

### OBJECTIVE

Provide a repeatable, CI‑ready visual regression suite so every PR can surface unintended UI changes early.

### DEPENDENCIES

* Auth flow (M1)
* Dashboard UI (M3\_PHASE\_06)
* Chat Interface (M3\_PHASE\_08)
* Survey CTA flow (M2\_PHASE\_01 + 02)

### TOOLING CHOICE

* **Playwright** with built‑in screenshot diff capability (lightweight, no Selenium bloat).
* Threshold: 0.1% pixel diff

### TASKS FOR CLAUDE

* ✅ Configure Playwright in repo root (`playwright.config.ts`).
* ✅ Write test script `visual.spec.ts` that:

  1. Boots local dev (`npm run dev` assumed running).
  2. Logs in with test admin creds.
  3. Captures dashboard, metrics chart, chat panel open.
  4. Starts survey, clicks first CTA, captures page.
* ✅ Store baseline images in `tests/visual/baselines/`.
* ✅ Add CI command `npm run test:visual`.
* ✅ Document how to update baselines.

### 📁 FILES TO ADD / UPDATE

```bash
playwright.config.ts
package.json  # add visual test script
tests/visual/visual.spec.ts
tests/visual/baselines/*.png   # autogenerated on first run
docs/VISUAL_TESTING.md  # add visual test instructions
```

### ✅ SUCCESS CRITERIA

* [ ] `npm run test:visual` captures snapshots and passes on clean UI.
* [ ] Introducing a deliberate 5px shift in UI triggers diff failure (>0.1%).
* [ ] Baseline update workflow documented in `TESTING.md`.
* [ ] CI pipeline runs visual tests after unit/integration suites.
* [ ] All Necessary Documentation has been reviewed and updated and/or added

### 🧪 VALIDATION LOOP

```bash
npm run lint
npm run type-check
npm run test:unit
npm run test:integration
npm run test:visual   # snapshots
```

### GOTCHAS

* Ensure deterministic data (seed DB) before snapshot.
* Run visual tests at consistent viewport size (e.g., 1366×768).
* Mask dynamic content (timestamps, random IDs) or hide with CSS before capture.

### REFERENCES

* PLANNING.md → Visual Snapshot Validation section
* CLAUDE.md → testing & modularity rules
* Playwright docs → [https://playwright.dev](https://playwright.dev)
* `prp_base.md` (PRP Base)
---


